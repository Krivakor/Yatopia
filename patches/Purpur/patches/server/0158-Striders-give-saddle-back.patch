From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ben Kerllenevich <me@notom3ga.me>
Date: Sun, 13 Dec 2020 20:40:57 -0500
Subject: [PATCH] Striders give saddle back


diff --git a/src/main/java/net/minecraft/server/EntityStrider.java b/src/main/java/net/minecraft/server/EntityStrider.java
index a0bb64bea373c678c519e3fae8f808fd36e1ee4f..11911b10ddc6e2a681f2eda313a6e7c68674a1ac 100644
--- a/src/main/java/net/minecraft/server/EntityStrider.java
+++ b/src/main/java/net/minecraft/server/EntityStrider.java
@@ -376,6 +376,18 @@ public class EntityStrider extends EntityAnimal implements ISteerable, ISaddleab
 
         if (!flag && this.hasSaddle() && !this.isVehicle() && !entityhuman.eq()) {
             if (!this.world.isClientSide) {
+                // Purpur start
+                if (world.purpurConfig.striderGiveSaddleBack && entityhuman.isSneaking()) {
+                    this.saddleStorage.setSaddle(false);
+                    if (!entityhuman.abilities.canInstantlyBuild) {
+                        ItemStack saddle = new ItemStack(Items.SADDLE);
+                        if (!entityhuman.inventory.pickup(saddle)) {
+                            entityhuman.drop(saddle, false);
+                        }
+                    }
+                    return EnumInteractionResult.SUCCESS;
+                }
+                // Purpur end
                 entityhuman.startRiding(this);
             }
 
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java.rej b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java.rej
index bcffbb53c3c40ebf02af0a064268f5069550d3f5..691bb4b2378df637775261997e67dc56b64819ee 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java.rej
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java.rej
@@ -1,120 +1,15 @@
 diff a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java	(rejected hunks)
-@@ -995,63 +1426,118 @@ public class PurpurWorldConfig {
-         snowGolemSnowBallMax = getInt("mobs.snow_golem.max-shoot-interval-ticks", snowGolemSnowBallMax);
-         snowGolemSnowBallModifier = (float) getDouble("mobs.snow_golem.snow-ball-modifier", snowGolemSnowBallModifier);
-         snowGolemAttackDistance = getDouble("mobs.snow_golem.attack-distance", snowGolemAttackDistance);
-+        if (PurpurConfig.version < 10) {
-+            double oldValue = getDouble("mobs.snow_golem.attributes.max-health", snowGolemMaxHealth);
-+            set("mobs.snow_golem.attributes.max-health", null);
-+            set("mobs.snow_golem.attributes.max_health", oldValue);
-+        }
-+        snowGolemMaxHealth = getDouble("mobs.snow_golem.attributes.max_health", snowGolemMaxHealth);
-     }
- 
-     public boolean squidRidable = false;
-     public boolean squidImmuneToEAR = true;
-     public double squidOffsetWaterCheck = 0.0D;
-     public boolean squidsCanFly = false;
-+    public double squidMaxHealth = 10.0D;
-     private void squidSettings() {
-         squidRidable = getBoolean("mobs.squid.ridable", squidRidable);
-         squidImmuneToEAR = getBoolean("mobs.squid.immune-to-EAR", squidImmuneToEAR);
-         squidOffsetWaterCheck = getDouble("mobs.squid.water-offset-check", squidOffsetWaterCheck);
-         squidsCanFly = getBoolean("mobs.squid.can-fly", squidsCanFly);
-+        if (PurpurConfig.version < 10) {
-+            double oldValue = getDouble("mobs.squid.attributes.max-health", squidMaxHealth);
-+            set("mobs.squid.attributes.max-health", null);
-+            set("mobs.squid.attributes.max_health", oldValue);
-+        }
-+        squidMaxHealth = getDouble("mobs.squid.attributes.max_health", squidMaxHealth);
-     }
- 
-     public boolean spiderRidable = false;
-     public boolean spiderRidableInWater = false;
-+    public double spiderMaxHealth = 16.0D;
-     private void spiderSettings() {
-         spiderRidable = getBoolean("mobs.spider.ridable", spiderRidable);
-         spiderRidableInWater = getBoolean("mobs.spider.ridable-in-water", spiderRidableInWater);
-+        if (PurpurConfig.version < 10) {
-+            double oldValue = getDouble("mobs.spider.attributes.max-health", spiderMaxHealth);
-+            set("mobs.spider.attributes.max-health", null);
-+            set("mobs.spider.attributes.max_health", oldValue);
-+        }
-+        spiderMaxHealth = getDouble("mobs.spider.attributes.max_health", spiderMaxHealth);
-     }
- 
-     public boolean strayRidable = false;
-     public boolean strayRidableInWater = false;
-+    public double strayMaxHealth = 20.0D;
-     private void straySettings() {
-         strayRidable = getBoolean("mobs.stray.ridable", strayRidable);
-         strayRidableInWater = getBoolean("mobs.stray.ridable-in-water", strayRidableInWater);
-+        if (PurpurConfig.version < 10) {
-+            double oldValue = getDouble("mobs.stray.attributes.max-health", strayMaxHealth);
-+            set("mobs.stray.attributes.max-health", null);
-+            set("mobs.stray.attributes.max_health", oldValue);
-+        }
-+        strayMaxHealth = getDouble("mobs.stray.attributes.max_health", strayMaxHealth);
-     }
- 
+@@ -1490,11 +1490,13 @@ public class PurpurWorldConfig {
      public boolean striderRidable = false;
      public boolean striderRidableInWater = false;
      public int striderBreedingTicks = 6000;
-+    public double striderMaxHealth = 20.0D;
++    public boolean striderGiveSaddleBack = false;
+     public double striderMaxHealth = 20.0D;
      private void striderSettings() {
          striderRidable = getBoolean("mobs.strider.ridable", striderRidable);
          striderRidableInWater = getBoolean("mobs.strider.ridable-in-water", striderRidableInWater);
          striderBreedingTicks = getInt("mobs.strider.breeding-delay-ticks", striderBreedingTicks);
-+        if (PurpurConfig.version < 10) {
-+            double oldValue = getDouble("mobs.strider.attributes.max-health", striderMaxHealth);
-+            set("mobs.strider.attributes.max-health", null);
-+            set("mobs.strider.attributes.max_health", oldValue);
-+        }
-+        striderMaxHealth = getDouble("mobs.strider.attributes.max_health", striderMaxHealth);
-     }
- 
-     public boolean tropicalFishRidable = false;
-+    public double tropicalFishMaxHealth = 3.0D;
-     private void tropicalFishSettings() {
-         tropicalFishRidable = getBoolean("mobs.tropical_fish.ridable", tropicalFishRidable);
-+        if (PurpurConfig.version < 10) {
-+            double oldValue = getDouble("mobs.tropical_fish.attributes.max-health", tropicalFishMaxHealth);
-+            set("mobs.tropical_fish.attributes.max-health", null);
-+            set("mobs.tropical_fish.attributes.max_health", oldValue);
-+        }
-+        tropicalFishMaxHealth = getDouble("mobs.tropical_fish.attributes.max_health", tropicalFishMaxHealth);
-     }
- 
-     public boolean turtleRidable = false;
-     public boolean turtleRidableInWater = false;
-     public int turtleBreedingTicks = 6000;
-+    public double turtleMaxHealth = 30.0D;
-     private void turtleSettings() {
-         turtleRidable = getBoolean("mobs.turtle.ridable", turtleRidable);
-         turtleRidableInWater = getBoolean("mobs.turtle.ridable-in-water", turtleRidableInWater);
-         turtleBreedingTicks = getInt("mobs.turtle.breeding-delay-ticks", turtleBreedingTicks);
-+        if (PurpurConfig.version < 10) {
-+            double oldValue = getDouble("mobs.turtle.attributes.max-health", turtleMaxHealth);
-+            set("mobs.turtle.attributes.max-health", null);
-+            set("mobs.turtle.attributes.max_health", oldValue);
-+        }
-+        turtleMaxHealth = getDouble("mobs.turtle.attributes.max_health", turtleMaxHealth);
-     }
- 
-     public boolean vexRidable = false;
-     public boolean vexRidableInWater = false;
-     public double vexMaxY = 256D;
-+    public double vexMaxHealth = 14.0D;
-     private void vexSettings() {
-         vexRidable = getBoolean("mobs.vex.ridable", vexRidable);
-         vexRidableInWater = getBoolean("mobs.vex.ridable-in-water", vexRidableInWater);
-         vexMaxY = getDouble("mobs.vex.ridable-max-y", vexMaxY);
-+        if (PurpurConfig.version < 10) {
-+            double oldValue = getDouble("mobs.vex.attributes.max-health", vexMaxHealth);
-+            set("mobs.vex.attributes.max-health", null);
-+            set("mobs.vex.attributes.max_health", oldValue);
-+        }
-+        vexMaxHealth = getDouble("mobs.vex.attributes.max_health", vexMaxHealth);
-     }
- 
-     public boolean villagerRidable = false;
++        striderGiveSaddleBack = getBoolean("mobs.strider.give-saddle-back", striderGiveSaddleBack);
+         if (PurpurConfig.version < 10) {
+             double oldValue = getDouble("mobs.strider.attributes.max-health", striderMaxHealth);
+             set("mobs.strider.attributes.max-health", null);
